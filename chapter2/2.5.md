# 第五课：创建检查列表与列表项
  
目前为止我们做了很多的设置和架构工作，但是本课中我们开始制作骨架部分。我们将加入创建检查列表，查看检查列表以及给他们添加项（同时也提供编辑项和列表的操作）的途径。这将是一个大动作，建议你先准备点咖啡。  
  
## 检查列表
第一件要做的事情是添加创建和展示检查列表所需的所有东西。意思是添加到类定义，修改之前创建的模板来展示真实的清单数据。  
先从设置类定义开始。  
**> 修改 src/pages/home/home.ts为如下：**
```typescript
import { Component } from '@angular/core';
import { NavController, AlertController, Platform } from 'ionic-angular';
import { ChecklistPage } from '../checklist/checklist';
import { ChecklistModel } from '../../models/checklist-model';
import { Data } from '../../providers/data';
import { Keyboard } from 'ionic-native';

@Component({
    selector: 'page-home',
    templateUrl: 'home.html'
})
export class HomePage {
    checklists: ChecklistModel[] = [];
    constructor(public nav: NavController, public dataService: Data, public  alertCtrl: AlertController, public platform: Platform) {
    }

    ionViewDidLoad() {
    }

    addChecklist(): void {
    }

    renameChecklist(checklist): void {
    }

    viewChecklist(checklist): void {
    }

    removeChecklist(checklist): void{
    }

    save(): void{
    }
}
```
在这里我们从Ionic库里面导入了不少东西。**NavController**你可以已经很熟悉了，但是**AlertController**可能就不那么熟悉了。AlertController允许我们向用户展示各种警告框，包括基本的提示框，带输入的提示框，确认框等等。我们以他作为添加新检查列表的途径。  
同时我们也导入了我们的**ChecklistPage**，我们稍后会实现他，最重要的是我们导入了上节课制作的Checklist Model。  
我们也导入了之前生成的Data提供者，但是他的具体功能后续才会实现。最后，我们从Ionic Native导入了‘Keyboard’，这样我们可以用他来确保稍后用户添加了检查列表之后能够关闭软键盘。  
在构造器中通过给NavController和Data添加*public*修饰符，我们就可以在类里通过*this.nav*和*this.dataService*来访问他们了。基本上他是以下内容的简短写法：
```typescript
constructor(nav: NavController, dataService: Data){
    this.nav = nav;
    this.dataService = dataService;
}
```
之前你应该看到过。  
我们也声明了一个*checklists*数组，类定义里面可以通过*this.checklists*来访问他。类定义里面的大量的函数将在后续一个一个的讲解。  

### addChecklist
这个方法提供给用户创建一个新的检查列表。他会启动一个提示框，然后使用其中输入的信息来创建一个新的检查列表（会用到我们之前创建的数据模型）。  
**> 修改 addChecklist 函数如下：**
```typescript
addChecklist(): void {
    let prompt = this.alertCtrl.create({
        title: 'New Checklist',
        message: 'Enter the name of your new checklist below:',
        inputs: [
            {
                name: 'name'
            }
        ],
        buttons: [
            {
                text: 'Cancel'
            },
            {
                text: 'Save',
                handler: data => {
                    let newChecklist = new ChecklistModel(data.name, []);
                    this.checklists.push(newChecklist);

                    newChecklist.checklist.subscribe(update => {
                        this.save();
                    });

                    this.save();
                }
            }
        ]
    });

    prompt.present();
}
```
我们给用户展示了一个提示框，提示框包含了一个输入域，两个按钮Cancel和Save。取消按钮除了关闭提示框之外，不做其他事情，但是保存按钮我们给他添加了一个处理器用于传递输入的数据。  
在处理器里面，我们先通过传入输入的名字到一个checklist model里生成了一个新的检查列表，然后将他**push**到咱们的*this.checklists*数组。然后我们订阅了我们给数据模型添加的observable来监听checklist的修改，然后其中会触发save函数。注意，我们这里调用了两次save，一个是observable触发的，另一个是直接触发的（因为我们添加了一个新的checklist）。  
最后，我们通过*present*方法呈现了这个提示框。  
如果你再次看模板文件的时候，会发现我们在add按钮点击的时候已经调用了这个函数。
```html
<button (click)="addChecklist()"><ion-icon name="add-circle"></ion-icon></button>
```
  
### renameChecklist
接下来我们来定义*renameChecklist*函数，看名字就知道是给checklist重命名的。  
**> 修改 renameChecklist 函数如下：**
```typescript
renameChecklist(checklist): void {
    let prompt = this.alertCtrl.create({
        title: 'Rename Checklist',
        message: 'Enter the new name of this checklist below:',
        inputs: [
            {
                name: 'name'
            }
        ],
        buttons: [
            {
                text: 'Cancel'
            },
            {
                text: 'Save',
                handler: data => {
                    let index = this.checklists.indexOf(checklist);
                    if(index > -1){
                        this.checklists[index].setTitle(data.name);
                        this.save();
                    }
                }
            }
        ]
    });

    prompt.present();
}
```
第一眼看起来和*addChecklist*函数很想，因为他本来就很像哇。用了同样的提示框，同样的输入框，童颜的按钮，只是处理器稍有区别而已。  
注意，这个函数有参数传入，也就是我们将要改名的checklist的引用。我们稍后修改模板来传入此参数，但是此刻我们假装他已经传入进来就可以了。  
我们使用此checklist的引用在*this.checklists*中查找然后将他设置为新的标题，然后触发save。  
你可能会记得我们已经在模板中设置了一个点击处理器来调用这个函数：
```html
<button light (click)="renameChecklist(checklist)"><ion-icon name="clipboard"></ion-icon></button>
```
  
### removeChecklist
接下来我们来加入删除checklist的能力。  
**> 修改 removeChecklist 函数如下：**
```typescript
removeChecklist(checklist): void{

    let index = this.checklists.indexOf(checklist);

    if(index > -1){
        this.checklists.splice(index, 1);
        this.save();
    }

}
```
这个函数简单多了，因为他没有用户输入需求，我们只需要处理掉这个checklist就可以了。跟之前做的一样，我们传入了一个checklist引用然后在*this.checklists*找到他。之后通过数组的**splice**方法简单的将他移除掉然后触发save就完成了。  
以下是模板中触发此函数的相关代码：
```html
<button danger (click)="removeChecklist(checklist)"><ion-icon name="trash"></ion-icon> Delete</button>
```
  
### viewChecklist